---
import Basic from '/src/layouts/Basic.astro'

import config from '/site-config.js'
import TrialForm from '/src/components/TrialForm.svelte'
import Input from '/src/components/FormInput.svelte'
import { getTagID } from '/src/components/Convertkit'
import { getEntryBySlug } from 'astro:content'
import { getFormID } from '../../components/Convertkit'

export const prerender = true

// const { productCode } = Astro.params
export function getStaticPaths() {
  return [
    { params: { code: 'ljs' } },
    { params: { code: 'ecss' } },
    { params: { code: 'uajs' } },
  ]
}

const { code } = Astro.params
const formID = getFormID('operations')
const tagID = getTagID(code.toUpperCase())
const stuff = await getEntryBySlug('trial', code)
const { Content } = await stuff.render()

const apiRoot = config.apiRoot
const endpoint = `${apiRoot}/product/trial`
---

<!-- What's needed here... 
Grab the content collection
Then a FORM that asks people to subscribe basically
Name and Email necessary
But it's not a Convertkit Form
This time it's a TrialForm -->
<Basic>
  <Content />

  <TrialForm action={endpoint} redirectTo=`trial/${code}/thanks` client:load>
    <!-- Not greate to have this here because Astro Slots Content seems to be loaded after all items in Svelte has been loaded -->
    <Input type='hidden' name='formID' value={formID} />
    <Input type='hidden' name='tagID' value={tagID} />
    <Input type='hidden' name='productCode' value={code} />
  </TrialForm>
</Basic>
